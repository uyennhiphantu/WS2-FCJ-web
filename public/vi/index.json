[
{
	"uri": "/vi/",
	"title": "Bắt đầu với Amazon Athena",
	"tags": [],
	"description": "",
	"content": "Làm việc với Amazon Athena Trong bài lab này, bạn sẽ tìm hiểu các khái niệm cơ bản và thực hành về Amazon Athena.\nNội dung Giới thiệu Các bước chuẩn bị Tạo kết nối đến máy chủ EC2 Quản lý session logs Port Forwarding Dọn dẹp tài nguyên "
},
{
	"uri": "/vi/1-introduce/1.1-athena/",
	"title": "Amazon Athena là gì?",
	"tags": [],
	"description": "",
	"content": "Amazon Athena là một dịch vụ truy vấn giúp dễ dàng tương tác và phân tích dữ liệu một cách hiệu quả trong Amazon S3 bằng cách sử dụng SQL tiêu chuẩn (ANSI SQL). Chúng ta không cần thực hiện thao tác Trích xuất-Chuyển đổi-Tải (ETL) để nhập dữ liệu vào Athena. Thay vào đó, xác định các lược đồ trỏ đến dữ liệu nằm trong Amazon S3 và để ngay lập tức bắt đầu đưa ra truy vấn cũng như nhận thông tin chuyên sâu. Athena không có máy chủ nên không có cơ sở hạ tầng để thiết lập, cung cấp hoặc quản lý nên bạn sẽ chỉ trả tiền cho những truy vấn mà bạn chạy.\nĐiều này cho phép bất kỳ ai có kiến thức về SQL có thể nhanh chóng đánh giá các tập dữ liệu quy mô lớn. Athena được tích hợp sẵn với AWS Glue Data Catalog, cho phép bạn xây dựng kho lưu trữ siêu dữ liệu chung trên nhiều dịch vụ, thu thập thông tin nguồn dữ liệu để định vị schema, và cập nhật Catalog của bạn với các định nghĩa về modified table và partition, đồng thời duy trì phiên bản schema.\nStart Querying Instantly Amazon Athena là một hệ thống không có máy chủ, bạn có thể nhanh chóng truy vấn dữ liệu của mình mà không cần phải thiết lập và quản lý bất kỳ máy chủ hoặc kho dữ liệu nào. Chỉ cần trỏ tới dữ liệu của bạn trong Amazon S3, xác định schema và bắt đầu truy vấn bằng trình chỉnh sửa truy vấn tích hợp sẵn. Amazon Athena cho phép bạn khai thác tất cả dữ liệu của mình trong S3 mà không cần thiết lập các quy trình phức tạp để trích xuất, chuyển đổi và tải dữ liệu (ETL).\nPay Per Query Bạn chỉ trả tiền cho dữ liệu được quét (data scanned) bởi Amazon Athena cũng như những truy vấn mà bạn chạy. Với mỗi terabyte mà bạn truy vấn, bạn sẽ bị tính phí là 5$. Bạn có thể tiết kiệm từ 30% đến 90% chi phí cho mỗi truy vấn và đạt được hiệu suất tốt hơn bằng cách nén, phân vùng và chuyển đổi dữ liệu của mình thành định dạng cột. Athena truy vấn dữ liệu trực tiếp trên Amazon S3. Không có phí lưu trữ bổ sung ngoài S3.\nOpen, Powerful, Standard Amazon Athena được xây dựng trên cơ sở của Presto và sử dụng Presto kết hợp với hỗ trợ cho ANSI SQL. Nó có khả năng hoạt động với nhiều định dạng dữ liệu chuẩn như CSV, JSON, ORC, Avro và Parquet. Athena được thiết kế đặc biệt để truy vấn nhanh chóng hoặc truy vấn đơn (ad-hoc query), bên cạnh đó nó cũng có khả năng xử lý phân tích phức tạp, bao gồm các large joins, window functions và cấu trúc dữ liệu mảng (arrays). Amazon Athena luôn sẵn sàng hỗ trợ và thực hiện các truy vấn bằng cách sử dụng tài nguyên tính toán trên nhiều cơ sở và thiết bị trong từng cơ sở. Nó lưu trữ dữ liệu cơ bản trên Amazon S3, đảm bảo tính sẵn có và bền bỉ của dữ liệu.\nFast, Really Fast Hiệu suất tương tác cao ngay cả đối với các tập dữ liệu lớn. Với Amazon Athena, bạn không cần phải lo lắng về việc có đủ tài nguyên điện toán hay nó có được hiệu suất truy vấn tương tác nhanh chóng hay không. Bởi vì Amazon Athena tự động thực hiện các truy vấn song song nên hầu hết kết quả đều được trả về trong vòng vài giây.\n"
},
{
	"uri": "/vi/3-basics/3.1-public-instance/",
	"title": "Điều kiện tiên quyết",
	"tags": [],
	"description": "",
	"content": "Nếu như bạn đang tự quản lý labs, hãy đảm bảo rằng bạn đã triển khai Cloudformation stack cho Labs - Athena Basics\n"
},
{
	"uri": "/vi/1-introduce/",
	"title": "Tổng quan",
	"tags": [],
	"description": "",
	"content": "Ngày nay, những vấn đề mà doanh nghiệp đang gặp phải có thể bao gồm về hiệu suất truy vấn kém, khả năng mở rộng thấp, hoặc khả năng hiển thị dữ liệu không linh hoạt. Do đó, mục đích của workshop lần này nhằm cung cấp những kiến thức cơ bản của Amazon Athena để có thể giải quyết những nhu cầu cơ bản mà doanh nghiệp đang gặp phải. Workshop này không bắt buộc bạn phải có kiến thức về Amazon Athena, nhưng nếu có thì nó là một lợi thế.\nTrong bài lab này, chúng ta sẽ tìm hiểu các khái niệm cơ bản và thực hành về Amazon Athena.\nNội dung Giới thiệu Các bước chuẩn bị Athena Basics "
},
{
	"uri": "/vi/2-prepare/",
	"title": "Các bước chuẩn bị",
	"tags": [],
	"description": "",
	"content": "Cloudformation Template Trước khi bắt đầu workshop Amazon Athena này, bạn cần tạo các tài nguyên AWS cần thiết. Để thực hiện việc này, chúng tôi cung cấp mẫu AWS CloudFormation để tạo stack chứa tài nguyên. Khi bạn tạo stack, AWS sẽ tạo một số tài nguyên trong tài khoản của bạn.\nĐể khởi chạy CloudFormation stack, hãy nhấp vào Launch Stack.\nCác mẫu này được tạo cho vùng us-east-1 region (N. Virginia) và sẽ không hoạt động ở các vùng khác. Không thay đổi bất kỳ tham số Cơ sở dữ liệu mặc định nào trong CloudFormation\nLabs - Athena Basics:\nCloudFormation stack sẽ mất khoảng 5 phút để hoàn thành.\nCloudFormation stack sẽ tạo ra những người dùng IAM cần thiết, Athena Workgroups và Athena Named Queries dùng để thử nghiệm các bài labs. Kiểm tra bảng điều khiển CloudFormation và đợi trạng thái hiển thị CREATE_COMPLETE như bên dưới:\nNhấp vào cloudformation stack và chuyển đến outputs tab, nó sẽ hiển thị tên S3 bucket được tạo cho workshop này: "
},
{
	"uri": "/vi/3-basics/3.2-load-datasets/",
	"title": "Tải bộ dữ liệu",
	"tags": [],
	"description": "",
	"content": "Trước khi Athena có thể sử dụng được để truy vấn dữ liệu, chúng ta cần phải tải dữ liệu vào nhóm s3.\nTải dữ liệu vào tài khoản của bạn Trong thanh điều hướng trên cùng, Chọn biểu tượng cloudshell. Sau khi tải xong nó sẽ hiển thị như hình dưới đây: Tiếp đến, sao chép và dán phần dưới đây vào terminal\naccountid=$(aws sts get-caller-identity --query \u0026#34;Account\u0026#34; --output text)\raws s3 cp s3://ws-assets-prod-iad-r-iad-ed304a55c2ca1aee/9981f1a1-abdc-49b5-8387-cb01d238bb78/v1/csv/customers.csv ./customers.csv\raws s3 cp s3://ws-assets-prod-iad-r-iad-ed304a55c2ca1aee/9981f1a1-abdc-49b5-8387-cb01d238bb78/v1/csv/sales.csv ./sales.csv\raws s3 cp customers.csv s3://athena-workshop-$accountid/basics/csv/customers/customers.csv\raws s3 cp sales.csv s3://athena-workshop-$accountid/basics/csv/sales/sales.csv\raws s3 cp s3://ws-assets-prod-iad-r-iad-ed304a55c2ca1aee/9981f1a1-abdc-49b5-8387-cb01d238bb78/v1/parquet/sales.zip ./sales.zip\raws s3 cp s3://ws-assets-prod-iad-r-iad-ed304a55c2ca1aee/9981f1a1-abdc-49b5-8387-cb01d238bb78/v1/parquet/customers.zip ./customers.zip\runzip -o sales.zip\runzip -o customers.zip\raws s3 sync ./sales s3://athena-workshop-$accountid/basics/parquet/sales\raws s3 sync ./customers s3://athena-workshop-$accountid/basics/parquet/customers\recho \u0026#34;----- done -----\u0026#34; Nếu lời nhắc \u0026ldquo;Safe Paste for multiline txt\u0026rdquo; được hiển thị, hãy chọn PASTE\nSau khi các lệnh xử lý hoàn tất, dữ liệu sẽ được tải vào vùng lưu trữ S3 trong tài khoản của bạn.\nĐể xác minh dữ liệu đã được tải, hãy làm theo các bước sau:\nTrong thanh Tìm kiếm ở đầu màn hình, tìm S3, sau đó chọn S3 trong kết quả tìm kiếm Xác định vị trí bucket đã được tạo cho workshop. Nó sẽ được đặt tên là athena-workshop-[số tài khoản AWS của bạn] ví dụ: athena-workshop-12345678910 Chọn bucket name và sau đó kiểm tra:\nCó một thư mục tên là basics Thư mục basics chứa các thư mục CSV và parquet Bây giờ bộ dữ liệu mà chúng ta sẽ sử dụng trong bài lab đã được tải vào tài khoản của bạn.\n"
},
{
	"uri": "/vi/3-basics/",
	"title": "Athena Basics",
	"tags": [],
	"description": "",
	"content": "DataSets Để thể hiện các tính năng của Athena Basics, một bộ dữ liệu tổng hợp đơn giản sẽ được sử dụng. Chúng ta sẽ sử dụng bộ dữ liệu sau cho bài labs cơ bản của Athena.\nKhách hàng - Tập hợp các bản ghi khách hàng tổng hợp (~96.000)\nBán hàng - Một tập hợp các hồ sơ bán hàng tổng hợp được liên kết ngược lại với khách hàng. (~287.000)\nPhần nội dung cơ bản của Athena bao gồm các mục chính như sau:\nNội dung 3.1 Điều kiện tiên quyết 3.2 Load Datasets 3.3 Tạo bảng 3.4 Tạo bảng với Glue 3.5 Tạo Chế độ xem 3.6 Tái sử dụng kết quả truy vấn 3.7 Kết quả và lịch sử truy vấn 3.8 ETL và Athena CTAS 3.9 Athena Workgroups 3.10 Trực quan hoá bằng QuickSight trên Athena "
},
{
	"uri": "/vi/3-basics/3.3-tao-bang/",
	"title": "Tạo bảng",
	"tags": [],
	"description": "",
	"content": "Athena kích hoạt Cloudwatch Metrics Trước tiên, hãy bật Cloudwatch Metrics cho primary Athena workgroup, qua đó chúng ta có thể xem các metrics sau khi chạy truy vấn trong workshop này.\nTừ các dịch vụ ở menu, tìm kiếm Athena và đi tới bảng điều khiển: Trong bảng điều khiển Athena, chọn biểu tượng bánh hamburger (3 đường ngang) ở góc trên cùng bên trái và chọn Workgroups rồi chọn primary workgroup. Chọn Edit Cuộn xuống mục Settings, chọn tính năng Publish query metrics to AWS CloudWatch và chọn tiếp Save changes Athena Interface - Thiết lập Athena results location Trong bảng điều khiển Athena, chọn biểu tượng bánh hamburger (3 đường ngang) ở góc trên cùng bên trái và chọn Query editor.\nChọn Settings và sau đó chọn Manage Trong Manage Settings, chọn Browse S3 Tìm bucket có tên: athena-workshop-\u0026laquo;id tài khoản\u0026raquo; ví dụ: athena-workshop-12345678910. Nhấn vào nút radio ở bên trái tên nhóm rồi chọn Choose. Bấm Save để lưu vị trí S3 Athena Interface - Tạo Bảng và Chạy Truy Vấn Ngay sau đây, chúng ta sẽ tạo một số bảng mới và chạy truy vấn cho nó.\nChọn Editor tab để hiển thị trình soạn thảo truy vấn Athena.\nĐảm bảo bạn đang ở trong default database trước khi bắt đầu chạy truy vấn. Kiểm tra xem danh sách thả xuống ở Database có hiển thị default không. Nếu bạn không thấy default database, hãy sao chép truy vấn bên dưới, vào mục editor truy vấn và chọn Run: CREATE database default\rỞ bước này chúng ta sẽ tạo 4 bảng mới:\ncustomer_csv\nsales_csv\ncustomer_parquet\nsales_parquet\nĐể tiết kiệm thời gian chúng ta sẽ sử dụng các truy vấn đã lưu.\nTạo bảng customer_csv:\nChọn Saved queries tab Chọn ID truy vấn cho truy vấn có tên: Athena_create_customers_csv để mở truy vấn Chọn Run Kiểm tra tab kết quả truy vấn để đảm bảo nó hiển thị là Completed Tạo bảng sales_csv:\nChọn Saved queries tab Chọn ID truy vấn cho truy vấn có tên: Athena_create_sale_csv để mở truy vấn Chọn Run Kiểm tra tab kết quả truy vấn để đảm bảo nó hiển thị là Completed Tạo bảng customer_parquet:\nChọn Saved queries tab Chọn ID truy vấn cho truy vấn có tên: Athena_create_customers_parquet để mở truy vấn Đánh dấu truy vấn CREATE TABLE Chọn Run Kiểm tra tab kết quả truy vấn để đảm bảo nó hiển thị là Completed Chọn dòng chữ MSCK REPAIR TABLE customer_parquet và chọn RUN để thêm phân vùng Sau khi hoàn tất, chọn dòng chữ SHOW PARTITIONS sales_parquet và chọn RUN Tạo bảng sales_parquet:\nChọn Saved queries tab Chọn ID truy vấn cho truy vấn có tên: Athena_create_sale_parquet để mở truy vấn Đánh dấu truy vấn CREATE TABLE Chọn Run Kiểm tra tab kết quả truy vấn để đảm bảo nó hiển thị là Completed Chọn dòng chữ: MSCK REPAIR TABLE sales_parquet và chọn run để thêm partitions Sau khi hoàn tất, chọn dòng chữ HOW PARTITIONS sales_parquet và chọn RUN Phân vùng dữ liệu trong Athena Bằng cách phân vùng dữ liệu, chúng ta có thể hạn chế lượng dữ liệu được quét bởi mỗi truy vấn, từ đó cải thiện hiệu suất và giảm chi phí. Bạn có thể phân vùng dữ liệu của mình bằng bất kỳ khoá nào. Một thực tế khá phổ biến là phân vùng dữ liệu dựa trên ngày hoặc giờ, nên thường dẫn đến giải pháp phân vùng đa cấp (Multi-level partitioning scheme).\nAthena có thể sử dụng các phân vùng kiểu Apache Hive, có đường dẫn dữ liệu chứa các cặp giá trị khóa được kết nối với nhau bằng dấu “=\u0026quot; (ví dụ: country=us/\u0026hellip; hoặc Year=2021/month=01/day=26/\u0026hellip;). Do đó, các đường dẫn bao gồm cả tên của các khóa phân vùng và các giá trị mà mỗi đường dẫn đại diện. Để tải các phân vùng Hive mới vào một bảng được phân vùng, chúng ta có thể sử dụng lệnh MSCK REPAIR TABLE, và lệnh này chỉ hoạt động với các phân vùng kiểu Hive.\nAthena cũng có thể sử dụng các sơ đồ phân vùng kiểu non-Hive. Ví dụ: nhật ký CloudTrail và luồng phân phối Kinesis Data Firehose sử dụng các thành phần đường dẫn riêng biệt cho các phần ngày như data/2021/01/26/us/6fc7845e.json. Đối với dữ liệu non-Hive, bạn nên sử dụng ALTER TABLE ADD PARTITION để thêm các phân vùng theo cách thủ công.\nSo sánh hiệu suất giữa các bảng Ở phần phía trên, chúng ta đã tạo xong các bảng, nên chúng ta sẽ chạy một số truy vấn để kiểm tra hiệu suất giữa các bảng:\nChọn Saved Queries tab Chọn ID truy vấn cho truy vấn có tên: Athena_Compare_Sales để mở truy vấn Chạy các truy vấn theo thứ tự bằng cách chọn SQL statement block mỗi lần và nhấp vào nút RUN. Trong phần Query Results, hãy lưu ý các giá trị Run Time và Data Scanned. Bạn sẽ thấy rằng khi truy vấn tệp parquet, số lượng Data Scanned ít hơn so với khi truy vấn tệp CSV. Lưu ý rằng Time Taken giữa tệp CSV và tệp parquet là tương tự nhau. Điều này xảy ra bởi vì chúng ta đang sử dụng các tập dữ liệu nhỏ cho bài lab. Khi làm việc với các tập tin có nhiều cột và hàng, parquet nhìn chung sẽ nhanh hơn. "
},
{
	"uri": "/vi/4-cleanup/",
	"title": "Dọn dẹp tài nguyên  ",
	"tags": [],
	"description": "",
	"content": "Chúng ta sẽ tiến hành các bước sau để xóa các tài nguyên chúng ta đã tạo trong bài thực hành này.\nXóa EC2 instance Truy cập giao diện quản trị dịch vụ EC2 Click Instances. Click chọn cả 2 instance Public Linux Instance và Private Windows Instance. Click Instance state. Click Terminate instance, sau đó click Terminate để xác nhận. Truy cập giao diện quản trị dịch vụ IAM Click Roles. Tại ô tìm kiếm , điền SSM. Click chọn SSM-Role. Click Delete, sau đó điền tên role SSM-Role và click Delete để xóa role. Click Users. Click chọn user Portfwd. Click Delete, sau đó điền tên user Portfwd và click Delete để xóa user. Xóa S3 bucket Truy cập giao diện quản trị dịch vụ System Manager - Session Manager. Click tab Preferences. Click Edit. Kéo chuột xuống dưới. Tại mục S3 logging. Bỏ chọn Enable để tắt tính năng logging. Kéo chuột xuống dưới. Click Save. Truy cập giao diện quản trị dịch vụ S3 Click chọn S3 bucket chúng ta đã tạo cho bài thực hành. ( Ví dụ : lab-fcj-bucket-0001 ) Click Empty. Điền permanently delete, sau đó click Empty để tiến hành xóa object trong bucket. Click Exit. Sau khi xóa hết object trong bucket, click Delete Điền tên S3 bucket, sau đó click Delete bucket để tiến hành xóa S3 bucket. Xóa các VPC Endpoint Truy cập vào giao diện quản trị dịch vụ VPC Click Endpoints. Chọn 4 endpoints chúng ta đã tạo cho bài thực hành bao gồm SSM, SSMMESSAGES, EC2MESSAGES, S3GW. Click Actions. Click Delete VPC endpoints. Tại ô confirm , điền delete. Click Delete để tiến hành xóa các endpoints. Click biểu tượng refresh, kiểm tra tất cả các endpoints đã bị xóa trước khi làm bước tiếp theo. Xóa VPC Truy cập vào giao diện quản trị dịch vụ VPC Click Your VPCs. Click chọn Lab VPC. Click Actions. Click Delete VPC. Tại ô confirm, điền delete để xác nhận, click Delete để thực hiện xóa Lab VPC và các tài nguyên liên quan. "
},
{
	"uri": "/vi/3-basics/3.4-tao-bang-glue/",
	"title": "Tạo bảng với Glue",
	"tags": [],
	"description": "",
	"content": "Trong bài lab này, chúng ta sẽ sử dụng Glue Crawler để thu thập dữ liệu về sales và tạo bảng mới trong AWS Glue Data Catalog. Sau đó chúng ta sẽ sử dụng Athena để truy vấn bảng đó.\nỞ thanh tìm kiếm đầu màn hình tìm :Glue sau đó chọn AWS Glue từ kết quả tìm kiếm để mở bảng điều khiển AWS Glue. Trong bảng điều khiển AWS Glue, hãy chọn Crawlers từ bảng chọn bên trái. Sau đó chọn Create Crawler Nhập Athena Sales ở mục Name và chọn Next Chọn Not yet cho câu hỏi \u0026ldquo;Is your data already mapped to Glue tables?”. Sau đó chọn tiếp Add a Data Source Đảm bảo rằng danh sách cuộn xuống của Data Source đã chọn S3. Trong file Path S3, chọn Browse S3 sau đó:\nChọn nhóm bắt đầu bằng athena-workshop-\nChọn thư mục Basics, sau đó chọn tiếp vào thư mục parquet\nNhấn vào vòng tròn bên trái thư mục sales\nChọn Choose\nGiữ nguyên các cài đặt khác và nhấn vào Add an S3 Data source 6. Chọn Next 7. Chọn Create new IAM Role, Nhận AWSGlueServiceRole-salescrawler làm tên vai trò và chọn Create 8. Chọn Next 9. Ở màn hình Set output and scheduling, chúng ta sẽ thiết lập như sau:\nTarget Database: default Table Name Prefix - optional: athena_glue_ Để nguyên các cài đặt khác và chọn Next Trên màn hình hiển thị Review and Create, chọn Create Crawler Khi crawler được tạo, hãy nhấp vào Run crawler. Có thể mất 2-4 phút để crawler hoàn thành. Sau khi crawler hoàn tất, bạn sẽ thấy 1 bảng được thêm vào. Truy vấn bảng mới với Athena Bây giờ chúng ta sẽ quay lại Bảng điều khiển Athena và sau đó chạy truy vấn.\nTrong thanh tìm kiếm phía trên màn hình tìm: Athena. Chọn Athena từ kết quả tìm kiếm để mở bảng điều khiển Athena Ở phía bên trái của query editor, bạn sẽ thấy bảng athena_glue_sales trong danh sách Tables. Chọn biểu tượng dấu ba chấm (3 dấu chấm) bên phải tên bảng rồi chọn Preview Table Truy vấn sẽ chạy và trả về dữ liệu sales. Vậy là bạn đã tạo thành công một bảng mới bằng cách sử dụng AWS Glue Crawler.\n"
},
{
	"uri": "/vi/3-basics/3.5-tao-view/",
	"title": "Tạo chế độ xem",
	"tags": [],
	"description": "",
	"content": "Chế độ xem trong Amazon Athena là một bảng logical chứ không phải một bảng physical. Truy vấn xác định chế độ xem sẽ chạy mỗi khi chế độ xem được tham chiếu trong truy vấn. Bạn có thể tạo chế độ xem từ truy vấn SELECT rồi tham chiếu chế độ xem này trong các truy vấn trong tương lai. Để biết thêm thông tin, hãy xem CREATE VIEW\nBây giờ chúng ta sẽ tạo mới chế độ xem Customer Lifetime Value trong Athena\nChọn Saved Queries trong Athena Query Editor. Từ danh sách, chọn truy vấn Athena_create_customer_lifetime_value_view. Có hai phần của truy vấn. Phần đầu tiên là tạo ra chế độ xem the customer lifetime value. Thứ hai là chọn dữ liệu từ chế độ xem. Đánh dấu truy vấn đầu tiên và chọn Run. Điều đó sẽ tạo ra một chế độ xem mới có tên là customer_lifetime_value Khi chế độ xem được tạo, nó sẽ xuất hiện ở Views trong trình điều hướng tài nguyên. Chọn truy vấn thứ hai và nhấn RUN để chọn 10 bản ghi đầu tiên từ chế độ xem. Vậy là bạn đã sử dụng thành công Athena để tạo chế độ xem trong danh mục AWS Glue Data catalog. "
},
{
	"uri": "/vi/3-basics/3.6-reuse-query/",
	"title": "Tái sử dụng Kết quả Truy vấn",
	"tags": [],
	"description": "",
	"content": " Khi chạy lại truy vấn trong Athena, chúng ta có thể tùy ý chọn sử dụng lại kết quả truy vấn được lưu trữ gần đây nhất. Tùy chọn này có thể tăng hiệu suất và giảm chi phí về số lượng bytes được quét. Ví dụ: việc sử dụng lại kết quả truy vấn sẽ hữu ích nếu biết rằng kết quả sẽ không thay đổi trong một khung thời gian nhất định. Chúng ta có thể chỉ định thời gian tối đa để sử dụng lại kết quả truy vấn. Athena sử dụng kết quả được lưu trữ miễn là nó không cũ hơn khoảng thời gian tồn tại mà chúng ta chỉ định.\nXác minh tính năng của Tái sử dụng Kết quả Truy vấn khả dụng Mở bảng điều khiển Athena bằng cách nhập Athena vào thanh tìm kiếm ở đầu màn hình. Chọn Athena từ kết quả tìm kiếm.\nĐể sử dụng lại kết quả truy vấn, trước tiên vui lòng xác minh xem tùy chọn \u0026lsquo;Reuse query results’ (được đánh dấu trong hình dưới đây) đã được bật hay chưa. Nếu nó được bật (bạn có thể kiểm tra bằng cách chọn chuyển đổi Reuse query results để xem nó đã bật hay chưa), sau đó bỏ qua phần này và chuyển xuống phần tính năng Testing the reuse query results feature section below. Nếu không, hãy hoàn thành các bước sau để bật tính năng này:\nChọn Workgroups trong Administration menu được thả xuống trên menu tab bên trái trên màn hình (được đánh dấu trong ảnh chụp màn hình bên dưới) và primary workgroup từ danh sách nhóm làm việc. Nhấp vào nút Edit ở phía trên bên phải của trang để chỉnh sửa cài đặt workgroup. Trong phần Upgrade Query Engine, nhấp vào nút radio Manual. Sau đó chọn Athena engine version 3 từ danh sách thả xuống của Query engine version. Chọn Save Changes ở góc dưới bên phải. Kiểm tra tính năng Tái sử dụng Kết quả Truy vấn Để xác minh tính năng tái sử dụng:\n1. Điều hướng quay lại **Query editor**\r2. Chọn biểu tượng + để thêm tab mới\r3. Sao chép và dán truy vấn bên dưới vào query editor.\rselect c.customer_id,concat(\u0026quot;firstname\u0026quot;,' ',\u0026quot;lastname\u0026quot;) as full_name,\rsum(cast(price as decimal(6,2))) as lifetime_value,\rcount(\u0026quot;timestamp\u0026quot;) as lifetime_purchase_count,\rsum(cast(price as decimal(6,2))) /count(\u0026quot;timestamp\u0026quot;) as average_spend_per_purchase\rfrom customers_parquet c join sales_parquet s on c.customer_id = s.customer_id\rgroup by c.customer_id,concat(\u0026quot;firstname\u0026quot;,' ',\u0026quot;lastname\u0026quot;),c.country;\rNhấn Reuse query results sang vị trí tắt. Chọn Run Ghi lại số liệu thống kê cho Truy vấn bao gồm các giá trị Run time và Data scanned. Nhấp vào nút Reuse query results để bật. Nhấp vào biểu tượng edit (tức là biểu tượng bút chì) bên dưới \u0026lsquo;Reuse query results’. Đặt thời gian sử dụng lại là 30 phút rồi nhấn nút Confirm. Chạy lại truy vấn bằng cách bấm vào nút Run again. Lưu ý sự khác biệt về Run time và Data scanned so với lần chạy ban đầu. Đi tới tab Recent Queries trong tab query editor và kiểm tra cột \u0026lsquo;Cache’ để xem giá trị \u0026lsquo;Result reuse’ đã được thêm vào trong quá trình thực thi. Điều này cho thấy rằng để thực hiện truy vấn đó, kết quả đã được sử dụng lại. Bạn có thể cần phải cuộn qua để tìm cột Cache\nChạy lại truy vấn và reuse time khác nhau sau khi xác minh. Ví dụ: thay đổi reuse time từ 30 phút thành 1 phút bằng cách sử dụng hướng dẫn ở Bước 7. Chạy lại truy vấn của bạn và kiểm tra xem nó có sử dụng lại kết quả hay không. Bây giờ bạn đã khám phá thành công tính năng query results reuse trong Amazon Athena.\n"
},
{
	"uri": "/vi/3-basics/3.7-his-re-query/",
	"title": "Kết quả và lịch sử truy vấn",
	"tags": [],
	"description": "",
	"content": " Amazon Athena tự động lưu trữ kết quả truy vấn và thông tin siêu dữ liệu cho mỗi truy vấn chạy ở trong kết quả truy vấn mà bạn có thể chỉ định trong Amazon S3. Nếu cần, bạn có thể truy cập vào các tệp ở đây để làm việc với chúng. Bạn cũng có thể tải xuống tệp kết quả truy vấn trực tiếp từ bảng điều khiển Athena.\nĐể xem lịch sử truy vấn, nhấp vào Recent queries. Chúng ta sẽ có thể xem tất cả các truy vấn được gửi trong workgroup, State, Run Time và Data scanned. Chúng ta cũng có thể chọn ID truy vấn và nhấp vào Download results để tải xuống dưới dạng dữ liệu csv. Thông tin chi tiết về từng truy vấn chạy cũng được lưu vào Athena results bucket của chúng ta. Trong thanh tìm kiếm ở đầu màn hình tìm S3 và nhấp vào S3 trong kết quả tìm kiếm Xác định vị trí bucket đã được tạo cho workshop. Nó sẽ được đặt tên là athena-workshop-[số tài khoản AWS của bạn] ví dụ: athena-workshop-12345678910. Nhấp vào tên bucket để mở nó. Có một prefix cho mỗi Saved Query đã được chạy và một thư mục Unsaved. Thư mục Unsaved lưu trữ kết quả của các truy vấn unsaved được thực hiện từ bảng điều khiển Athena. Lưu ý: Nếu không thấy thư mục Unsaved, bạn có thể sao chép một trong các truy vấn trước đó vào Query tab mới trong Athena, chạy truy vấn đó rồi kiểm tra lại trong S3 bucket. Nhấp vào Athena_compare_sale prefix, sau đó nhấp vào prefix Year,prefix Month và prefix Day. Bạn sẽ thấy kết quả được lưu trữ với id truy vấn. "
},
{
	"uri": "/vi/3-basics/3.8-etl-athe/",
	"title": "ETL và Athena CTAS",
	"tags": [],
	"description": "",
	"content": " Thông thường, dữ liệu thô được đưa vào data lake ở định dạng csv hoặc văn bản. Các định dạng này không tối ưu để truy vấn với Athena và các công cụ khác. Nên chuyển đổi dữ liệu thành các định dạng cột như parquet. Trong bài lab này, chúng ta sẽ sử dụng truy vấn Create Table As Select ( CTAS ) để tạo bảng mới từ bảng định dạng csv hiện có. Truy vấn Create Table as Select (CTAS) sẽ tạo một bảng định dạng parquet mới có tính năng nén và phân vùng, sau đó điền dữ liệu vào bảng đó.\nTừ Athena query editor, chọn Saved Queries và nhấn vào ID truy vấn cho truy vấn có tên Athena_ctas_customer_sale Có 2 câu lệnh truy vấn trong truy vấn ở saved query. Truy vấn đầu tiên sẽ tạo một bảng mới có tên là customer_sale_ctas. Nếu bạn nhìn vào câu lệnh truy vấn, có một số điều cần lưu ý: Định dạng được đặt thành parquet là định dạng bảng cột Chúng ta đang lưu trữ các tập tin ở vị trí bên ngoài. Trong trường hợp này, s3 bucket được tạo cho workshop ở /basics/parquet/sale_ctas/ prefix. Dữ liệu sẽ được phân chia theo năm, tháng, ngày Chúng ta đang sử dụng truy vấn SELECT để chọn dữ liệu từ các bảng hiện có để điền vào bảng mới. Đánh dấu truy vấn đầu tiên và chọn Run để tạo bảng mới. Sẽ mất vài phút để truy vấn này chạy. Khi nó hiển thị Completed trong tab kết quả truy vấn, hãy chuyển sang bước tiếp theo. Đánh dấu truy vấn thứ hai và nhấp vào nút Run Điều này sẽ truy vấn bảng mới tạo của bạn. Qua đó, chúng ta đã tạo thành công một bảng mới trong data lake của mình và thêm dữ liệu vào đó bằng truy vấn Athena Create Table As Select (CTAS).\n"
},
{
	"uri": "/vi/3-basics/3.9-athena-wg-/",
	"title": "Athena Workgroups",
	"tags": [],
	"description": "",
	"content": " Trong Amazon Athena, bạn có thể sử dụng workgroups để chia người dùng, nhóm, ứng dụng hoặc khối lượng công việc, để đặt giới hạn về lượng dữ liệu mà mỗi truy vấn hoặc toàn bộ workgroups có thể xử lý và theo dõi chi phí. Vì workgroups hoạt động như tài nguyên nên bạn có thể sử dụng các chính sách dựa trên danh tính ở cấp độ tài nguyên để kiểm soát quyền truy cập vào workgroups cụ thể.\nViewings Cloudwatch Metrics\nTrong bài lab Tạo bảng, chúng ta đã bật số liệu Cloudwatch cho primary workgroup. Bây giờ, hãy xem số liệu Cloudwatch cho primary workgroup của chúng ta trong bảng điều khiển Athena.\nTừ bảng điều khiển Athena, chọn Workgroups từ menu bên trái. Chọn primary workgroup từ danh sách workgroups Nhấp vào tab Metrics trên màn hình chi tiết Workgroups. Bạn sẽ thấy các metrics bao gồm: Total data scanned Totoal succeeded queries Total failed queries Total execution time Biểu đồ có thể không hiển thị nhiều điểm dữ liệu vì chúng sẽ phản ánh việc sử dụng tài khoản lab của chúng ta.\nThực thi các hạn chế về chi phí Chi phí cho truy vấn Athena SQL dựa trên lượng dữ liệu được quét. Với workgroups, bạn có thể thực thi các ràng buộc về chi phí cho các truy vấn bằng cách đặt lượng dữ liệu tối đa mà một truy vấn hoặc workgroups có thể quét. Điều này sẽ được thể hiện bằng cách đặt giới hạn cho workgroup, sau đó đăng nhập bằng người dùng mới để kiểm tra xem giới hạn hoạt động như thế nào.\nBây giờ chúng ta sẽ đặt lượng dữ liệu tối đa có thể được quét bởi bất kỳ truy vấn nào trong workgroups.\nTrong menu bên trái, xác định vị trí và chọn Workgroups. Sau đó nhấn WorkgroupA để xem chi tiết workgroups. Ở mục Data Usage controls tabs, chọn Manage Đặt dữ liệu tối đa được quét bởi bất kỳ truy vấn nào trong nhóm làm việc này là 110 Megabytes (MB), sau đó chọn Save Kiểm tra giới hạn workgroup Để kiểm tra giới hạn Workgroup mới, chúng ta sẽ đăng nhập với tư cách người dùng mới. Trước khi thực hiện việc này, bạn cần truy xuất thông tin chi tiết về người dùng mới, bao gồm mật khẩu và liên kết đăng nhập.\nTrong thanh tìm kiếm gõ Cloudformation và chọn CloudFormation từ kết quả tìm kiếm Trên bảng điều khiển CloudFormation, nhấp vào tên của workshop stack, ví dụ: athena-workshop Nhấp vào tab Outputs và bấm vào liên kết ConsolePassword. Thao tác này sẽ đưa bạn đến AWS Secrets Manager. Bấm vào link Secret Name như hình dưới đây: Chọn Retrieve secret value như hình dưới đây: Bấm vào biểu tượng sao chép để sao chép mật khẩu vào clipboard Quay lại tab đầu ra Cloudformation (tham khảo các bước 1,2,3 ở trên) và nhấp vào liên kết ConsoleLogin. Thao tác này sẽ mở trang đăng nhập bảng điều khiển AWS. Nhập các giá trị sau và nhấp vào mục Sign In IAM user name: userA\nPassword: Sử dụng mật khẩu đã sao chép từ bước ở trên\nSau khi bạn đã đăng nhập thành công với tư cách UserA:\nMở bảng điều khiển Athena bằng cách nhập Athena vào thanh tìm kiếm ở đầu màn hình. Chọn Athena từ kết quả tìm kiếm.\nNhấn vào phần cuộn xuống ở Workgroup và chọn WorkgroupA. Nếu nhận được lời nhắc bên dưới, hãy chọn Acknowledge Sao chép và dán văn bản bên dưới vào query editor.\n`` /* This query will fail as it exceeds the 10 MB limit */ select * from customers_csv\n/* This query will succeed as it only scans 9 MB of data */ select * from customers_parquet ``\nĐánh dấu truy vấn đầu tiên và chọn Run. Xin lưu ý rằng truy vấn không thành công và hiển thị lỗi Bytes scanned limit was exceeded. Điều này là do truy vấn sẽ quét nhiều hơn giới hạn 10 MB mà chúng ta đã đặt cho workgroup này. Bây giờ hãy đánh dấu truy vấn thứ hai và nhấp vào nút Run. Lưu ý rằng truy vấn này thành công vì nó chỉ quét dưới 10 MB dữ liệu. Sử dụng Workgroups để tách người dùng, nhóm hoặc ứng dụng truy vấn thành các nhóm Chúng ta có thể sử dụng Workgroups để tách biệt các truy vấn cho người dùng, nhóm hoặc ứng dụng và áp dụng các giới hạn truy vấn khác nhau. IAM Policies có thể được sử dụng để kiểm soát quyền truy cập vào Workgroups. Để chứng minh điều này, chúng ta sẽ thử chuyển đổi Workgroups và xem liệu UserA có thể chạy cùng một truy vấn trong Workgroups B hay không.\nTrong danh sách cuộn xuống ở Workgroups, chọn \u0026ldquo;WorkgroupB\u0026rdquo;. Lưu ý rằng Error fetching workgroup có thể được hiển thị. Điều này là do UserA không có quyền họ cần để nhận tất cả thông tin chi tiết về workgroup B Sao chép và dán các truy vấn từ bước 12, đánh dấu truy vấn đầu tiên và chọn Run. Lưu ý lỗi mà bạn nhận được. Điều này là do UserA không có quyền bắt đầu truy vấn. Bây giờ chúng ta đã biết cách sử dụng Athena Workgroups để tách biệt các truy vấn giữa người dùng, nhóm và ứng dụng. Hơn thế nữa, chúng ta cũng đã sử dụng Workgroup data limits để giới hạn lượng dữ liệu mà các workgroup có thể truy vấn.\n"
},
{
	"uri": "/vi/3-basics/3.10-qs/",
	"title": "Trực quan hoá bằng QuickSight trên Amazon Athena",
	"tags": [],
	"description": "",
	"content": " Trong bài lab này, chúng ta sẽ xây dựng Bảng điều khiển Amazon QuickSight mà nó sử dụng Amazon Athena để truy cập dữ liệu.\nTrước khi bạn bắt đầu thiết lập Quicksight, chúng ta cần đăng xuất khỏi AWS và đăng nhập lại với người dùng có quyền thiết lập QuickSight. Điều này là do trong bài lab về Workgroups, chúng ta đã đăng nhập vào AWS với tư cách UserA để kiểm tra các quyền của Athena Workgroups. Để thoát ra:\nNhấp vào username ở góc trên bên phải của trang. Nhấp vào nút Sign out Self Paced Labs - Đăng nhập lại vào Bảng điều khiển AWS của bạn với tư cách là người dùng IAM có quyền thiết lập QuickSight. Thiết lập QuickSight Sau khi đăng nhập lại, hãy thiết lập Amazon Quicksight\nTìm kiếm Quicksight ở thanh tìm kiếm rồi chọn. Thao tác này sẽ đưa bạn đến trang đích QuickSight Nếu Tài khoản AWS của bạn chưa đăng ký QuickSight, bạn sẽ được nhắc đăng ký. Bấm vào Sign up for Quicksight Chọn Enterprise edition và nhấp vào Continue. Trên màn hình tiếp theo, nếu bạn nhận được lời nhắc Get Paginated add-on, hãy nhấp vào 1. No,Maybe later Chọn Create your Quicksight account như sau: Select a region của bạn từ danh sách đươc cuộn xuống Nhập tên tài khoản QuickSight duy nhất. Tên tài khoản chỉ được chứa ký tự (A-Za-z), chữ số (0-9) và dấu gạch ngang (-)\rNhập địa chỉ email để QuickSight gửi các thông báo quan trọng. Giữ tất cả các giá trị mặc định khác.\rTrong phần QuickSight Access to AWS Services, hãy làm như sau: Kiểm tra Amazon S3. Thao tác này sẽ mở ra một cửa sổ bật lên để chọn nhóm S3. Đánh dấu vào ô Select All và nhấn nút Finish. Nhấp vào nút Finish. Tài khoản QuickSight của bạn bây giờ sẽ được tạo. Sau khi hoàn thành, bạn sẽ thấy thông báo Congratulations\nNhấp vào nút Go to Amazon QuickSight. Thao tác này sẽ tải Quicksight. LƯU Ý: Nếu bạn nhận được thông báo về các tính năng bật lên, bạn có thể đóng nó lại. Tạo Quicksight Datasets Bây giờ, chúng ta sẽ tạo một tập dữ liệu mới cho bảng thông tin QuickSight kết nối với một trong các bảng mà chúng ta đã tạo trong Athena.\nChọn New Analysis ở góc trên cùng bên phải. Điều này sẽ hiển thị một danh sách datasets hiện có. Chúng ta sẽ tạo một tập dữ liệu mới vì vậy hãy nhấp vào nút New dataset ở góc trên cùng bên trái. Bạn sẽ thấy Quicksight có thể kết nối với nhiều nguồn dữ liệu khác nhau. Xác định vị trí biểu tượng Athena và chọn nó. Đối với Data source name, hãy nhập “athenaimmersion” và chọn Create Data Source Trên Next screen, chọn cơ sở dữ liệu “default“ và chọn bảng customer_sale_ctas rồi chọn Select Ở phần finish data set creation, chọn tùy chọn “Directly query your data” và chọn tiếp mục Visualize. Bây giờ bạn sẽ thấy trình chỉnh sửa phân tích QuickSight mà chúng ta sẽ sử dụng để tạo phân tích mới. Tạo biểu đồ QuickSight Trong phần này, chúng ta sẽ tạo một phân tích rất đơn giản bằng cách sử dụng customer sales data set. Từ Fields List, kéo country vào AutoGraph Box. QuickSight tự động chọn loại Horizontal bar chart. Bạn sẽ thấy số lượng hồ sơ bán hàng theo Country. xây dựng một biểu đồ khác.\nNhấp vào khoảng trống màu xám bên dưới biểu đồ thanh hiện có. Từ danh sách Field, nhấp vào Month. Điều này sẽ thêm một Horizontal bar chart mới vào trang phân tích Dữ liệu này có thể trông đẹp hơn dưới dạng line chart. Trong ngăn \u0026ldquo;Visual Types”, hãy tìm loại Line Chart và nhấp vào nó. Lưu ý cách loại biểu đồ tự động thay đổi từ bar chart sang line chart. Sẽ rất tốt nếu xem số lượng giao dịch ở mỗi quốc gia. Từ Field List, nhấp vào country. Lưu ý cách line chart tự động làm mới và bây giờ chúng ta có mỗi đường cho mỗi quốc gia. Hãy chú ý đến biểu đồ, các tháng ở trục dưới cùng đang bị sai thứ tự. Để khắc phục điều đó, hãy nhấp vào thanh màu xám phía trên biểu đồ có tên Field Wells. Thanh Field Wells sẽ mở rộng. Trong X-Axis box, bạn sẽ thấy month trường. Chọn vào mũi tên xuống ở phía bên phải của file. Điều này sẽ hiển thị một menu. Trong phần Sort by theo ở đầu menu hãy nhấp vào biểu tượng sort ascending. Lưu ý rằng các tháng ở trục dưới cùng hiện đã theo đúng thứ tự. Bây giờ bạn đã sử dụng thành công Amazon QuickSight để kết nối với dữ liệu của mình thông qua Amazon Athena. "
},
{
	"uri": "/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]